<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Vehicle Registrations - UPM</title>
		<link rel="stylesheet" href="/css/globals.css" />
		<link rel="stylesheet" href="/css/spending.css" />
	</head>
	<body>
		<div class="container">
			<%- include('partials/header') %>
			<main class="main-content">
				<div class="page-header">
					<h1 class="page-title">Vehicle <span>Registrations</span></h1>
				</div>
				<div class="table-section">
					<h2 class="table-title">VEHICLE REGISTRATIONS</h2>
								<div class="table-container" style="overflow-x:auto;">
									<table class="spending-table" style="min-width:1100px;">
							<thead>
								<tr>
									<th>User</th>
									<th>Owner Name</th>
									<th>Vehicle Type</th>
									<th>Vehicle Model</th>
									<th>Chassis Number</th>
									<th>Engine Number</th>
									<th>Proof of Residence</th>
									<th>Proof of Identity</th>
									<th>Status</th>
									<th>Created At</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody>
								<% if (vehicleRegistrations && vehicleRegistrations.length > 0) { %>
									<% vehicleRegistrations.forEach(function(reg) { %>
										<tr>
											<td><%= reg.user && reg.user.pingId ? reg.user.pingId : 'N/A' %></td>
											<td><%= reg.ownerName %></td>
											<td><%= reg.vehicleType %></td>
											<td><%= reg.vehicleModel %></td>
											<td><%= reg.chassisNumber %></td>
											<td><%= reg.engineNumber %></td>
											<td>
												<% if (reg.proofResidence && reg.proofResidence.filePath) { %>
													<a href="/uploads/<%= reg.proofResidence.filePath %>" target="_blank">View</a>
												<% } else { %>
													N/A
												<% } %>
											</td>
											<td>
												<% if (reg.proofIdentity && reg.proofIdentity.filePath) { %>
													<a href="/uploads/<%= reg.proofIdentity.filePath %>" target="_blank">View</a>
												<% } else { %>
													N/A
												<% } %>
											</td>
											<td><%= reg.status %></td>
											<td><%= reg.createdAt ? reg.createdAt.toLocaleString() : 'N/A' %></td>
																	<td style="white-space:nowrap; max-width:120px; text-align:center;">
																		<% if (reg.status === 'pending') { %>
																			<div style="display: flex; flex-direction: column; gap: 6px; align-items: center;">
																				<form action="/admin/vehicle-registrations/<%= reg._id %>/approve" method="POST" style="margin:0;">
																					<button type="submit" style="padding:4px 10px; background:#4CAF50; color:#fff; border:none; border-radius:3px; cursor:pointer; min-width:80px;">Approve</button>
																				</form>
																				<form action="/admin/vehicle-registrations/<%= reg._id %>/reject" method="POST" style="margin:0;">
																					<button type="submit" style="padding:4px 10px; background:#F44336; color:#fff; border:none; border-radius:3px; cursor:pointer; min-width:80px;">Reject</button>
																				</form>
																			</div>
																		<% } else { %>
																			<span style="color:#888;">-</span>
																		<% } %>
																	</td>
										</tr>
									<% }) %>
								<% } else { %>
									<tr>
										<td colspan="11" style="text-align:center; color:#888;">No vehicle registrations found.</td>
									</tr>
								<% } %>
							</tbody>
						</table>
					</div>
				</div>
			</main>
		</div>
	</body>
</html>
