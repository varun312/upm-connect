<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UPM Dashboard</title>
    <link rel="stylesheet" href="css/newpg.css" />
    <link rel="stylesheet" href="css/globals.css" />
  </head>
  <body style="height: 100vh; margin: 0; padding: 0; overflow-y: auto; background: #f7e8d9;">
    <div class="container" style="min-height: 100vh; overflow-y: auto;">
      <!-- Header -->
      <%- include('partials/header') %>
      <!-- Main Content -->
      <main class="main-content">
        <!-- Service Cards Row -->
        <div class="service-cards-container">
          <div class="service-card">
            <div class="card-header">
              <div class="card-icon">
                <img src="/assets/card1-icon.svg" />
              </div>
              <h3>Core Services</h3>
            </div>
            <div class="card-content">
              <a class="service-item" href="/business-application-form" style="text-decoration:none; color:inherit;">
                <span class="service-icon">üè¢</span>
                <span>Business Application</span>
              </a>
              <a class="service-item" href="/vehicle-registration-form" style="text-decoration:none; color:inherit;">
                <span class="service-icon">üöó</span>
                <span>Vehicle Registration</span>
              </a>
              <a class="service-item" href="/loan-application-form" style="text-decoration:none; color:inherit;">
                <span class="service-icon">üí∞</span>
                <span>Loan Application</span>
              </a>
            </div>
          </div>

          <div class="service-card">
            <div class="card-header">
              <div class="card-icon">
                <img src="/assets/card1-icon.svg" />
              </div>
              <h3>Transparency Hub</h3>
            </div>
            <div class="card-content">
              <a class="service-item" href="/spendings" style="text-decoration:none; color:inherit;">
                <span class="service-icon">üìä</span>
                <span>Open spending tracker</span>
              </a>
              <a class="service-item" href="/meeting-minutes" style="text-decoration:none; color:inherit;">
                <span class="service-icon">üìù</span>
                <span>Meeting minutes</span>
              </a>
            </div>
          </div>

          <div class="service-card">
            <div class="card-header">
              <div class="card-icon">
                <img src="/assets/card1-icon.svg" />
              </div>
              <h3>Get Involved</h3>
            </div>
            <div class="card-content">
              <a class="service-item" href="/townhall" style="text-decoration:none; color:inherit;">
                <span class="service-icon">üí¨</span>
                <span>Town hall forum</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Dashboard Cards Row -->
        <div class="dashboard-cards-container">
          <div class="dashboard-card application-tracker">
            <h3>Application Tracker</h3>
            <div class="tracker-content">
              <% 
                // Combine all applications and vaultDocs into a single array with type
                let trackerItems = [];
                if (applications && applications.length > 0) {
                  applications.forEach(function(app) {
                    trackerItems.push({
                      type: 'Application',
                      label: app.category,
                      status: app.status
                    });
                  });
                }
                if (typeof businessApplications !== 'undefined' && businessApplications.length > 0) {
                  businessApplications.forEach(function(app) {
                    trackerItems.push({
                      type: 'Business Application',
                      label: app.businessName,
                      status: app.status
                    });
                  });
                }
                if (typeof loanApplications !== 'undefined' && loanApplications.length > 0) {
                  loanApplications.forEach(function(app) {
                    trackerItems.push({
                      type: 'Loan Application',
                      label: app.loanPurpose + ' - ' + app.loanAmount,
                      status: app.status
                    });
                  });
                }
                if (typeof vehicleRegistrations !== 'undefined' && vehicleRegistrations.length > 0) {
                  vehicleRegistrations.forEach(function(app) {
                    trackerItems.push({
                      type: 'Vehicle Registration',
                      label: app.vehicleType + ' - ' + app.vehicleModel,
                      status: app.status
                    });
                  });
                }
                if (vaultDocs && vaultDocs.length > 0) {
                  vaultDocs.forEach(function(doc) {
                    trackerItems.push({
                      type: 'Document',
                      label: doc.docType ? doc.docType : 'Document',
                      status: doc.status
                    });
                  });
                }
              %>
              <% if (trackerItems.length > 0) { %>
                <% trackerItems.forEach(function(item) { %>
                  <div class="tracker-item">
                    <span class="tracker-type" style="display:inline-block; font-size:0.8em; background:#e0e7ef; color:#1e293b; border-radius:4px; padding:2px 8px; margin-right:8px; font-weight:600;">
                      <%= item.type %>
                    </span>
                    <span class="tracker-label"><%= item.label %></span>
                    <% if (item.status === 'pending') { %>
                      <span class="progress-text" style="color:#f59e42; font-weight:600; margin-left:10px;">Pending</span>
                      <div class="progress-bar" style="background:#f3f4f6; height:8px; border-radius:4px; margin-top:6px;">
                        <div class="progress-fill" style="width: 50%; background:#f59e42; height:100%; border-radius:4px;"></div>
                      </div>
                    <% } else if (item.status === 'approved' || item.status === 'verified') { %>
                      <span class="progress-text" style="color:#22c55e; font-weight:600; margin-left:10px;">Approved</span>
                      <div class="progress-bar" style="background:#f3f4f6; height:8px; border-radius:4px; margin-top:6px;">
                        <div class="progress-fill" style="width: 100%; background:#22c55e; height:100%; border-radius:4px;"></div>
                      </div>
                    <% } else if (item.status === 'rejected') { %>
                      <span class="progress-text" style="color:#ef4444; font-weight:600; margin-left:10px;">Rejected</span>
                      <div class="progress-bar" style="background:#f3f4f6; height:8px; border-radius:4px; margin-top:6px;">
                        <div class="progress-fill" style="width: 100%; background:#ef4444; height:100%; border-radius:4px;"></div>
                      </div>
                    <% } %>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="tracker-item">
                  <span class="tracker-label">No applications or documents to track.</span>
                </div>
              <% } %>
            </div>
          </div>

          <div id="digital-vault">
            <h3>Digital Vault</h3>
            <div class="vault-content">
              <% if (vaultDocs && vaultDocs.length > 0) { %>
                <% vaultDocs.forEach(function(doc) { %>
                  <div class="vault-item">
                    <span class="vault-label"><%= doc.docType ? doc.docType : 'Document' %></span>
                    <% if (doc.status === 'pending') { %>
                      <span class="vault-status pending" style="color: #f59e42; font-weight: bold;">PENDING</span>
                    <% } else if (doc.status === 'verified' || doc.status === 'approved') { %>
                      <span class="vault-status verified" style="background-color: #fef08a; color: #3a3a3a; font-weight: bold; padding: 2px 8px; border-radius: 4px;">VERIFIED</span>
                    <% } else if (doc.status === 'rejected') { %>
                      <span class="vault-status rejected" style="color: #ef4444; font-weight: bold;">REJECTED</span>
                    <% } else { %>
                      <span class="vault-status unknown" style="color: #888; font-weight: bold;">UNKNOWN</span>
                    <% } %>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="vault-item">
                  <span class="vault-label">No documents uploaded yet.</span>
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>