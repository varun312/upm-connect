<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - UPM</title>
    <link rel="stylesheet" href="css/globals.css" />
    <link rel="stylesheet" href="css/admin.css" />
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-title">Admin Panel</div>
        <a href="/admin/applications" class="dashboard-link"
          >Manage Applications</a
        >
        <a href="/admin/documents" class="dashboard-link">Manage Documents</a>
        <a href="/admin/meetings" class="dashboard-link">Manage Meetings</a>
        <a href="/admin/spendings" class="dashboard-link">Manage Spendings</a>
      </aside>

      <div style="flex: 1; display: flex; flex-direction: column">
        <!-- Main Content -->
        <main class="main-content">
          <!-- Page Header -->
          <div class="page-header">
            <h1 class="page-title">Admin <span>Dashboard</span></h1>
          </div>

          <!-- Table Section -->
          <div class="table-section">
            <h2 class="table-title">USERS PENDING APPROVAL</h2>
            <div class="table-container">
              <table class="spending-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>DOB</th>
                    <th>Gender</th>
                    <th>Address</th>
                    <th>Issue Date</th>
                    <th>Proof of Residence</th>
                    <th>Proof of Identity</th>
                    <th>Approve</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (users && users.length > 0) { %> <%
                  users.forEach(function(user) { %>
                  <tr id="user-row-<%= user._id %>">
                    <td><%= user.firstName %> <%= user.lastName %></td>
                    <td><%= user.dob.toISOString().slice(0,10) %></td>
                    <td><%= user.gender %></td>
                    <td><%= user.adres %></td>
                    <td><%= user.issuedate.toISOString().slice(0,10) %></td>
                    <td>
                      <a
                        href="/uploads/<%= user.proofResidence.file %>"
                        target="_blank"
                        >View</a
                      >
                    </td>
                    <td>
                      <a
                        href="/uploads/<%= user.proofIdentity.file %>"
                        target="_blank"
                        >View</a
                      >
                    </td>
                    <td>
                      <button
                        id="approve-btn-<%= user._id %>"
                        onclick="approveUser('<%= user._id %>')"
                        class="approve-btn"
                      >
                        Approve
                      </button>
                    </td>
                  </tr>
                  <% }) %> <% } else { %>
                  <tr>
                    <td colspan="10" style="text-align: center; color: #888">
                      No users pending approval.
                    </td>
                  </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Vault -->
           
        </main>
      </div>
    </div>
    <script>
      function approveUser(userId) {
        fetch(`/admin/approve/${userId}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "same-origin",
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              document.getElementById("user-row-" + userId).style.background =
                "#d4ffd4";
              // Disable the approve button after approval
              document.getElementById("approve-btn-" + userId).disabled = true;
              document.getElementById("approve-btn-" + userId).innerText =
                "Approved";
            }
          });
      }
    </script>
  </body>
</html>
